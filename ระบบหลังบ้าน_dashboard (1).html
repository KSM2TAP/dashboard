<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.herokuapp.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Sarabun', 'Noto Sans Thai', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .mini-chart {
            height: 200px;
        }
        .login-overlay {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-connected { background-color: #00C853; }
        .status-disconnected { background-color: #FF6B6B; }
        .status-loading { background-color: #FFA726; }
        .product-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s;
        }
        .product-card:hover {
            transform: translateY(-2px);
        }
        .profit-positive { color: #00C853; font-weight: bold; }
        .profit-negative { color: #FF6B6B; font-weight: bold; }
        .dashboard-export {
            background: white;
            padding: 40px;
            font-family: 'Sarabun', 'Noto Sans Thai', sans-serif;
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Login Overlay -->
    <div id="loginOverlay" class="fixed inset-0 login-overlay flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 card-shadow">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
                <p class="text-gray-600">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets</p>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                    <input type="email" id="loginEmail" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="sales@company.com" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                </button>
                <p class="text-xs text-gray-500 text-center mt-4">‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ: admin@demo.com / password123</p>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="gradient-bg text-white py-6 px-6">
            <div class="max-w-7xl mx-auto">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h1 class="text-3xl font-bold">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h1>
                        <p class="text-lg opacity-90 mt-2">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheet - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
                        <div class="flex items-center mt-2">
                            <span id="connectionStatus" class="status-indicator status-disconnected"></span>
                            <span id="connectionText" class="text-sm opacity-75">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets</span>
                            <span id="lastUpdated" class="text-sm opacity-75 ml-4">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ</span>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button id="connectSheetsBtn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-200">
                            üìä ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Sheets
                        </button>
                        <button id="refreshBtn" class="bg-white text-blue-600 px-4 py-2 rounded-md hover:bg-gray-100 transition duration-200 disabled:opacity-50" disabled>
                            üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                        </button>
                        <button id="diagnosticBtn" class="bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700 transition duration-200 disabled:opacity-50" disabled>
                            üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                        </button>
                        <button id="addProductBtn" class="bg-yellow-600 text-white px-4 py-2 rounded-md hover:bg-yellow-700 transition duration-200 disabled:opacity-50" disabled>
                            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                        </button>
                        <button id="exportBtn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-200 disabled:opacity-50" disabled>
                            üì∏ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å
                        </button>
                        <button id="logoutBtn" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200">
                            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Setup Instructions -->
        <div id="setupInstructions" class="max-w-7xl mx-auto px-6 py-6">
            <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-6 mb-6">
                <h3 class="font-semibold text-blue-800 mb-3">üìã ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô - ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Sheet</h3>
                <div class="text-blue-700 space-y-3">
                    <div id="connectionError" class="bg-red-50 border border-red-200 p-4 rounded text-sm mb-4 hidden">
                        <p class="font-semibold text-red-800 mb-2">üîí ‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</p>
                        <p class="text-red-700 mb-3">Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</p>
                        <ol class="list-decimal list-inside mt-2 text-red-700 space-y-1">
                            <li>‡πÄ‡∏õ‡∏¥‡∏î Google Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</li>
                            <li>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "‡πÅ‡∏ä‡∏£‡πå" (‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô)</li>
                            <li>‡∏Ñ‡∏•‡∏¥‡∏Å "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå"</li>
                            <li><strong>‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏õ‡πá‡∏ô "‡∏ú‡∏π‡πâ‡∏î‡∏π" (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ú‡∏π‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)</strong></li>
                            <li>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Sheet ID ‡∏à‡∏≤‡∏Å URL (‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á /d/ ‡πÅ‡∏•‡∏∞ /edit)</li>
                            <li>‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>
                        </ol>
                        <div class="mt-3 p-2 bg-yellow-50 border-l-4 border-yellow-400">
                            <p class="text-yellow-800 font-medium">üìã ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£: ‡∏ú‡∏π‡πâ‡∏î‡∏π</p>
                            <p class="text-yellow-700 text-xs">Canva AI ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded border text-sm">
                        <p><strong>‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (‡πÅ‡∏ñ‡∏ß 1-2):</strong></p>
                        <p>‚Ä¢ B1-I1: ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô 1-8</p>
                        <p>‚Ä¢ B2-I2: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ï‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô | N2: ‡∏Å‡∏≥‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á | P2: ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
                        <p>‚Ä¢ Q2: VAT 7% | S2: ‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á | T2: ‡∏Ñ‡πà‡∏≤ COD 2% | U2: VAT COD | X2: VAT ‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</p>
                    </div>
                    <div class="bg-white p-4 rounded border text-sm">
                        <p><strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡πÅ‡∏ñ‡∏ß 3 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ):</strong></p>
                        <p>‚Ä¢ A3: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà | B3-I3: ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</p>
                        <p>‚Ä¢ K3: ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå | L3: ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | M3: ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ | W3: ‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</p>
                        <p>‚Ä¢ AA3: ‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå | AE3: VAT ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢ | AG3: ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</p>
                    </div>
                    <p><strong>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏™‡∏î‡∏á:</strong> ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå, ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢, ‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤, ‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå, VAT ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢, ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</p>
                </div>
            </div>
        </div>

        <!-- Date Range Filter -->
        <section class="max-w-7xl mx-auto px-6 mb-6">
            <div class="bg-white rounded-lg p-6 card-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</h3>
                    <div class="flex items-center space-x-2">
                        <span id="selectedDaysCount" class="text-sm text-gray-600 bg-blue-50 px-3 py-1 rounded-full">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏ß‡∏±‡∏ô</span>
                        <span id="dateRangeDisplay" class="text-sm font-medium text-blue-600"></span>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                        <input type="date" id="startDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                        <input type="date" id="endDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex space-x-2">
                        <button id="filterBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex-1" disabled>
                            üìä ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                        </button>
                        <div class="relative">
                            <button id="quickRangeBtn" class="px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50" disabled>
                                ‚ö° ‡πÄ‡∏£‡πá‡∏ß
                            </button>
                            <div id="quickRangeMenu" class="absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-10 hidden min-w-40">
                                <button class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-50" data-range="today">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                                <button class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-50" data-range="yesterday">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô</button>
                                <button class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-50" data-range="last7">7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</button>
                                <button class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-50" data-range="last30">30 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</button>
                                <button class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-50" data-range="thisMonth">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
                                <button class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-50" data-range="lastMonth">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</button>
                                <button class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-50" data-range="thisYear">‡∏õ‡∏µ‡∏ô‡∏µ‡πâ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Overall Summary KPIs -->
        <section class="max-w-7xl mx-auto px-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h2>
                <div class="text-right">
                    <div class="text-sm text-gray-600">‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <div id="summaryPeriod" class="text-lg font-semibold text-blue-600">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                </div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4 mb-6">
                <div class="bg-white rounded-lg p-4 card-shadow text-center">
                    <div class="text-2xl mb-2">üõí</div>
                    <div class="text-sm text-gray-600">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏ß‡∏°</div>
                    <div id="totalOrders" class="text-xl font-bold text-blue-600">0</div>
                </div>
                <div class="bg-white rounded-lg p-4 card-shadow text-center">
                    <div class="text-2xl mb-2">üì¶</div>
                    <div class="text-sm text-gray-600">‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏ß‡∏°</div>
                    <div id="totalItems" class="text-xl font-bold text-green-600">0</div>
                </div>
                <div class="bg-white rounded-lg p-4 card-shadow text-center">
                    <div class="text-2xl mb-2">üí∞</div>
                    <div class="text-sm text-gray-600">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                    <div id="totalSales" class="text-xl font-bold text-purple-600">0 ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div class="bg-white rounded-lg p-4 card-shadow text-center">
                    <div class="text-2xl mb-2">üì¢</div>
                    <div class="text-sm text-gray-600">‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</div>
                    <div id="totalAds" class="text-xl font-bold text-orange-600">0 ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div class="bg-white rounded-lg p-4 card-shadow text-center">
                    <div class="text-2xl mb-2">üìä</div>
                    <div class="text-sm text-gray-600">‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>
                    <div id="avgAdsPerOrder" class="text-xl font-bold text-indigo-600">0 ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div class="bg-white rounded-lg p-4 card-shadow text-center">
                    <div class="text-2xl mb-2">üèõÔ∏è</div>
                    <div class="text-sm text-gray-600">VAT ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢</div>
                    <div id="totalVAT" class="text-xl font-bold text-red-600">0 ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div id="totalProfitCard" class="rounded-lg p-4 card-shadow text-center">
                    <div class="text-2xl mb-2">üíé</div>
                    <div class="text-sm opacity-90">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</div>
                    <div id="totalProfit" class="text-xl font-bold">0 ‡∏ö‡∏≤‡∏ó</div>
                </div>
            </div>
        </section>

        <!-- Daily Breakdown -->
        <section class="max-w-7xl mx-auto px-6 mb-8" id="dailyBreakdownSection">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">üìä ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
                <div class="text-sm text-gray-500">
                    <span id="dailyBreakdownCount">0</span> ‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                </div>
            </div>
            <div class="bg-white rounded-lg p-6 card-shadow">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b-2 border-gray-200">
                                <th class="text-left py-3 font-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th class="text-right py-3 font-semibold">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th>
                                <th class="text-right py-3 font-semibold">‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th class="text-right py-3 font-semibold">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</th>
                                <th class="text-right py-3 font-semibold">‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
                                <th class="text-right py-3 font-semibold">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th>
                                <th class="text-right py-3 font-semibold">VAT (‡∏ö‡∏≤‡∏ó)</th>
                                <th class="text-right py-3 font-semibold">‡∏Å‡∏≥‡πÑ‡∏£ (‡∏ö‡∏≤‡∏ó)</th>
                            </tr>
                        </thead>
                        <tbody id="dailyBreakdownTable">
                            <tr>
                                <td colspan="8" class="text-center py-8 text-gray-500">
                                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                                </td>
                            </tr>
                        </tbody>
                        <tfoot id="dailyBreakdownFooter" class="hidden">
                            <tr class="border-t-2 border-gray-300 bg-gray-50 font-semibold">
                                <td class="py-3">‡∏£‡∏ß‡∏°</td>
                                <td class="text-right py-3" id="footerOrders">0</td>
                                <td class="text-right py-3" id="footerItems">0</td>
                                <td class="text-right py-3" id="footerSales">0</td>
                                <td class="text-right py-3" id="footerAds">0</td>
                                <td class="text-right py-3" id="footerAvgPerOrder">0</td>
                                <td class="text-right py-3" id="footerVAT">0</td>
                                <td class="text-right py-3" id="footerProfit">0</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </section>

        <!-- Product Breakdown -->
        <section class="max-w-7xl mx-auto px-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">üéØ ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                <div class="text-sm text-gray-500">
                    <span id="productCount">0</span> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="productCards">
                <!-- Product cards will be populated here -->
            </div>
        </section>

        <!-- Charts Section -->
        <section class="max-w-7xl mx-auto px-6 mb-8">
            <h2 class="text-2xl font-bold mb-6">üìä ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h3 class="text-lg font-semibold mb-4">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô <span id="trendChartPeriod">(‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</span></h3>
                    <div class="chart-container">
                        <canvas id="salesTrendChart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h3 class="text-lg font-semibold mb-4">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <div class="chart-container">
                        <canvas id="productOrdersChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h3 class="text-lg font-semibold mb-4">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h3>
                    <div class="chart-container">
                        <canvas id="costDistributionChart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h3 class="text-lg font-semibold mb-4">‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <div class="chart-container">
                        <canvas id="profitByProductChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Detailed Data Table -->
        <section class="max-w-7xl mx-auto px-6 mb-8">
            <div class="bg-white rounded-lg p-6 card-shadow">
                <h3 class="text-lg font-semibold mb-4">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-2">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th class="text-right py-2">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th>
                                <th class="text-right py-2">‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th class="text-right py-2">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</th>
                                <th class="text-right py-2">‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
                                <th class="text-right py-2">VAT (‡∏ö‡∏≤‡∏ó)</th>
                                <th class="text-right py-2">‡∏Å‡∏≥‡πÑ‡∏£ (‡∏ö‡∏≤‡∏ó)</th>
                                <th class="text-center py-2">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="productTable">
                            <tr>
                                <td colspan="8" class="text-center py-8 text-gray-500">
                                    ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <!-- Google Sheets Connection Modal -->
    <div id="sheetsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</h3>
                <button id="closeSheetsModal" class="text-gray-500 hover:text-gray-700">‚úï</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Google Sheet ID</label>
                    <input type="text" id="sheetId" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                    <p class="text-xs text-gray-500 mt-1">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å URL ‡∏Ç‡∏≠‡∏á Google Sheet ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á /d/ ‡πÅ‡∏•‡∏∞ /edit</p>
                </div>
                <div class="flex justify-end space-x-3">
                    <button id="cancelSheetsBtn" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button id="connectBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                        <span class="loading-spinner hidden"></span>
                        ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
                <button id="closeAddProductModal" class="text-gray-500 hover:text-gray-700">‚úï</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                    <input type="text" id="productName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ C">
                    <p class="text-xs text-gray-500 mt-1">‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á sheet ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô Google Sheets ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                </div>
                <div class="flex justify-end space-x-3">
                    <button id="cancelAddProductBtn" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button id="addProductConfirmBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Options Modal -->
    <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h3>
                <button id="closeExportModal" class="text-gray-500 hover:text-gray-700">‚úï</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å</label>
                    <select id="exportFormat" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="png">PNG (‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á)</option>
                        <option value="jpeg">JPEG (‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î)</option>
                        <option value="pdf">PDF (‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏ß‡∏°‡∏™‡πà‡∏ß‡∏ô</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" id="includeSummary" checked class="mr-2">
                            <span class="text-sm">‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeProducts" checked class="mr-2">
                            <span class="text-sm">‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeCharts" checked class="mr-2">
                            <span class="text-sm">‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeTable" class="mr-2">
                            <span class="text-sm">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span>
                        </label>
                    </div>
                </div>
                <div class="flex justify-end space-x-3">
                    <button id="cancelExportBtn" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button id="exportConfirmBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                        <span class="loading-spinner hidden"></span>
                        ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let productsData = {};
        let currentSheetId = localStorage.getItem('multiProductSheetId') || '1_AlPuPpKbc1vkuEFXZg7ipM3BDoJ-w_dw2HU5JXGkaE';
        let isConnected = false;
        let charts = {};
        
        // Set default date range to match your Google Sheet data (September 2025)
        // Since your sheet starts from 18/09/2025, we'll set a range that includes your data
        let currentStartDate = '2025-09-01'; // September 1, 2025
        let currentEndDate = '2025-09-30';   // September 30, 2025
        let allDailyData = []; // Store all daily data for range filtering
        
        console.log(`üóìÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ${currentStartDate} ‡∏ñ‡∏∂‡∏á ${currentEndDate} (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)`);

        // Thai date formatting function
        function formatDateThai(dateStr) {
            if (!dateStr) return '';
            
            try {
                // Handle both YYYY-MM-DD and DD/MM/YYYY formats
                let date;
                if (dateStr.includes('/')) {
                    // DD/MM/YYYY format
                    const parts = dateStr.split('/');
                    if (parts.length === 3) {
                        const day = parseInt(parts[0], 10);
                        const month = parseInt(parts[1], 10);
                        const year = parseInt(parts[2], 10);
                        date = new Date(year, month - 1, day);
                    }
                } else {
                    // YYYY-MM-DD format
                    date = new Date(dateStr + 'T12:00:00');
                }
                
                if (date && !isNaN(date.getTime())) {
                    const day = date.getDate().toString().padStart(2, '0');
                    const month = (date.getMonth() + 1).toString().padStart(2, '0');
                    const year = date.getFullYear();
                    return `${day}/${month}/${year}`;
                }
            } catch (error) {
                console.warn('Error formatting date:', dateStr, error);
            }
            
            return dateStr; // Return original if parsing fails
        }

        // Authentication - Fixed login functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
            
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('üìù ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á');
                    
                    const email = document.getElementById('loginEmail').value.trim();
                    const password = document.getElementById('loginPassword').value.trim();
                    
                    console.log('üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', { email: email, passwordLength: password.length });
                    
                    if (email === 'admin@demo.com' && password === 'password123') {
                        console.log('‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î');
                        
                        try {
                            // Hide login overlay
                            const loginOverlay = document.getElementById('loginOverlay');
                            const dashboard = document.getElementById('dashboard');
                            
                            if (loginOverlay && dashboard) {
                                loginOverlay.classList.add('hidden');
                                dashboard.classList.remove('hidden');
                                dashboard.classList.add('animate-fade-in');
                                
                                console.log('üéØ ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß');
                                
                                // Set date inputs to current range
                                const startDateInput = document.getElementById('startDate');
                                const endDateInput = document.getElementById('endDate');
                                
                                if (startDateInput && endDateInput) {
                                    startDateInput.value = currentStartDate;
                                    endDateInput.value = currentEndDate;
                                    console.log(`üóìÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${currentStartDate} ‡∏ñ‡∏∂‡∏á ${currentEndDate}`);
                                    updateDateRangeDisplay();
                                }
                                
                                // Load demo data first to show something immediately
                                console.log('üöÄ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏•‡∏≠‡∏á...');
                                loadDemoData();
                                
                                // Then try to connect to Google Sheet
                                setTimeout(() => {
                                    console.log('üîó ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheet...');
                                    connectToSheet('1_AlPuPpKbc1vkuEFXZg7ipM3BDoJ-w_dw2HU5JXGkaE');
                                }, 500);
                            } else {
                                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö element ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô');
                                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö');
                            }
                        } catch (error) {
                            console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö:', error);
                            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                        }
                    } else {
                        console.log('‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                        alert('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n\n‡πÉ‡∏ä‡πâ:\n‡∏≠‡∏µ‡πÄ‡∏°‡∏•: admin@demo.com\n‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô: password123');
                    }
                });
            } else {
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', function() {
            document.getElementById('loginOverlay').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        });

        // Modal Controls
        document.getElementById('connectSheetsBtn').addEventListener('click', function() {
            document.getElementById('sheetId').value = currentSheetId;
            document.getElementById('sheetsModal').classList.remove('hidden');
        });

        document.getElementById('closeSheetsModal').addEventListener('click', function() {
            document.getElementById('sheetsModal').classList.add('hidden');
        });

        document.getElementById('cancelSheetsBtn').addEventListener('click', function() {
            document.getElementById('sheetsModal').classList.add('hidden');
        });

        document.getElementById('connectBtn').addEventListener('click', function() {
            const sheetId = document.getElementById('sheetId').value.trim();
            if (sheetId) {
                connectToSheet(sheetId);
                document.getElementById('sheetsModal').classList.add('hidden');
            } else {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Google Sheet ID ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
        });

        // Add Product Modal
        document.getElementById('addProductBtn').addEventListener('click', function() {
            if (!isConnected) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            document.getElementById('addProductModal').classList.remove('hidden');
        });

        document.getElementById('closeAddProductModal').addEventListener('click', function() {
            document.getElementById('addProductModal').classList.add('hidden');
        });

        document.getElementById('cancelAddProductBtn').addEventListener('click', function() {
            document.getElementById('addProductModal').classList.add('hidden');
        });

        document.getElementById('addProductConfirmBtn').addEventListener('click', function() {
            const productName = document.getElementById('productName').value.trim();
            if (productName) {
                addNewProduct(productName);
                document.getElementById('addProductModal').classList.add('hidden');
                document.getElementById('productName').value = '';
            } else {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
            }
        });

        // Export Modal
        document.getElementById('exportBtn').addEventListener('click', function() {
            if (!isConnected) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            document.getElementById('exportModal').classList.remove('hidden');
        });

        document.getElementById('closeExportModal').addEventListener('click', function() {
            document.getElementById('exportModal').classList.add('hidden');
        });

        document.getElementById('cancelExportBtn').addEventListener('click', function() {
            document.getElementById('exportModal').classList.add('hidden');
        });

        document.getElementById('exportConfirmBtn').addEventListener('click', function() {
            exportDashboard();
        });

        // Control Buttons
        document.getElementById('refreshBtn').addEventListener('click', function() {
            if (currentSheetId) {
                loadAllProductData(currentSheetId);
            }
        });

        // Diagnostic button to help troubleshoot data issues
        document.getElementById('diagnosticBtn').addEventListener('click', async function() {
            if (!currentSheetId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheet ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            console.log('üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö...');
            alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö browser console (F12) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î');
            
            try {
                // Test CSV access
                const csvUrl = `https://docs.google.com/spreadsheets/d/${currentSheetId}/export?format=csv&gid=0&cachebust=${Date.now()}`;
                console.log('üåê ‡∏ó‡∏î‡∏™‡∏≠‡∏ö CSV URL:', csvUrl);
                
                const response = await fetch(csvUrl);
                console.log('üì° ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö:', response.status, response.statusText);
                
                if (response.ok) {
                    const csvText = await response.text();
                    console.log('üìÑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß CSV:', csvText.length, '‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
                    console.log('üìã 1000 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏£‡∏Å:', csvText.substring(0, 1000));
                    
                    const lines = csvText.split('\n');
                    console.log('üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:', lines.length);
                    
                    // Check specific rows
                    console.log('üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ñ‡∏ß‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:');
                    console.log('‡πÅ‡∏ñ‡∏ß 1 (‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠):', lines[0]?.substring(0, 200));
                    console.log('‡πÅ‡∏ñ‡∏ß 2 (‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà):', lines[1]?.substring(0, 200));
                    console.log('‡πÅ‡∏ñ‡∏ß 3 (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏£‡∏Å):', lines[2]?.substring(0, 200));
                    
                    // Parse and check data
                    const testData = parseCSVData(csvText);
                    console.log('‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏î‡πâ:', testData.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                    
                    if (testData.length > 0) {
                        console.log('üìà ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', testData[0]);
                        alert(`‚úÖ ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!\n\n‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ${testData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö console ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î`);
                    } else {
                        alert('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!\n\n‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö console ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç');
                    }
                } else {
                    console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á sheet ‡πÑ‡∏î‡πâ:', response.status);
                    alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ!\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡πÑ‡∏î‡πâ"');
                }
            } catch (error) {
                console.error('‚ùå ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error);
                alert('‚ùå ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß!\n\n‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö console ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
            }
        });

        // Date range controls
        document.getElementById('startDate').addEventListener('change', updateDateRangeDisplay);
        document.getElementById('endDate').addEventListener('change', updateDateRangeDisplay);
        
        document.getElementById('filterBtn').addEventListener('click', function() {
            const newStartDate = document.getElementById('startDate').value;
            const newEndDate = document.getElementById('endDate').value;
            
            if (!newStartDate || !newEndDate) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î');
                return;
            }
            
            if (newStartDate > newEndDate) {
                alert('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÑ‡∏î‡πâ');
                return;
            }
            
            console.log('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å', currentStartDate, '‡πÄ‡∏õ‡πá‡∏ô', newStartDate, '-', newEndDate);
            
            currentStartDate = newStartDate;
            currentEndDate = newEndDate;
            
            // Calculate and display the number of days
            const startDate = new Date(currentStartDate);
            const endDate = new Date(currentEndDate);
            const dayCount = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            
            console.log(`‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${dayCount} ‡∏ß‡∏±‡∏ô ‡∏à‡∏≤‡∏Å ${currentStartDate} ‡∏ñ‡∏∂‡∏á ${currentEndDate}`);
            
            // Update the dashboard with new range
            updateDashboard();
            
            // Show success message for multi-day ranges
            if (dayCount > 1) {
                console.log(`‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${dayCount} ‡∏ß‡∏±‡∏ô ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß`);
            }
        });

        // Quick range dropdown
        document.getElementById('quickRangeBtn').addEventListener('click', function() {
            const menu = document.getElementById('quickRangeMenu');
            menu.classList.toggle('hidden');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('quickRangeMenu');
            const btn = document.getElementById('quickRangeBtn');
            if (!menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });

        // Quick range options
        document.querySelectorAll('[data-range]').forEach(button => {
            button.addEventListener('click', function() {
                const range = this.dataset.range;
                const today = new Date();
                let startDate, endDate;

                switch(range) {
                    case 'today':
                        startDate = endDate = new Date();
                        break;
                    case 'yesterday':
                        startDate = endDate = new Date(today.getTime() - 24 * 60 * 60 * 1000);
                        break;
                    case 'last7':
                        startDate = new Date(today.getTime() - 6 * 24 * 60 * 60 * 1000);
                        endDate = new Date();
                        break;
                    case 'last30':
                        startDate = new Date(today.getTime() - 29 * 24 * 60 * 60 * 1000);
                        endDate = new Date();
                        break;
                    case 'thisMonth':
                        startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                        endDate = new Date();
                        break;
                    case 'lastMonth':
                        startDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                        endDate = new Date(today.getFullYear(), today.getMonth(), 0);
                        break;
                    case 'thisYear':
                        startDate = new Date(today.getFullYear(), 0, 1);
                        endDate = new Date();
                        break;
                }

                document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
                document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
                updateDateRangeDisplay();
                document.getElementById('quickRangeMenu').classList.add('hidden');
            });
        });

        // Google Sheets Functions
        async function connectToSheet(sheetId) {
            try {
                updateConnectionStatus('loading', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets...');
                const connectBtn = document.getElementById('connectBtn');
                const spinner = connectBtn.querySelector('.loading-spinner');
                
                connectBtn.disabled = true;
                spinner.classList.remove('hidden');
                
                currentSheetId = sheetId;
                localStorage.setItem('multiProductSheetId', sheetId);
                
                await loadAllProductData(sheetId);
                
                updateConnectionStatus('connected', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÅ‡∏•‡πâ‡∏ß');
                enableButtons();
                document.getElementById('setupInstructions').style.display = 'none';
                document.getElementById('connectionError').classList.add('hidden');
                
            } catch (error) {
                console.error('‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error);
                updateConnectionStatus('disconnected', '‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏•‡∏≠‡∏á');
                
                // Show connection error in the UI
                document.getElementById('connectionError').classList.remove('hidden');
                
                // Show detailed error message
                const errorMsg = `‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}\n\n` +
                    `‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:\n` +
                    `1. ‡πÄ‡∏õ‡∏¥‡∏î Google Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì\n` +
                    `2. ‡∏Ñ‡∏•‡∏¥‡∏Å "‡πÅ‡∏ä‡∏£‡πå" ‚Üí "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå"\n` +
                    `3. ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏õ‡πá‡∏ô "‡∏ú‡∏π‡πâ‡∏î‡∏π"\n` +
                    `4. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Sheet ID ‡∏à‡∏≤‡∏Å URL\n\n` +
                    `‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÑ‡∏î‡πâ`;
                
                alert(errorMsg);
                
                // Load demo data so user can still use the dashboard
                loadDemoData();
                enableButtons();
            } finally {
                const connectBtn = document.getElementById('connectBtn');
                const spinner = connectBtn.querySelector('.loading-spinner');
                connectBtn.disabled = false;
                spinner.classList.add('hidden');
            }
        }

        async function loadAllProductData(sheetId) {
            try {
                console.log('‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å sheet:', sheetId);
                
                // Method 1: Try CSV export with no-cache headers
                try {
                    const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=0&cachebust=${Date.now()}`;
                    console.log('‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ CSV:', csvUrl);
                    
                    const response = await fetch(csvUrl, {
                        method: 'GET',
                        mode: 'cors',
                        cache: 'no-cache',
                        headers: {
                            'Cache-Control': 'no-cache',
                            'Pragma': 'no-cache'
                        }
                    });
                    
                    if (response.ok) {
                        const csvText = await response.text();
                        console.log('‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV ‡πÅ‡∏•‡πâ‡∏ß, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß:', csvText.length);
                        console.log('500 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏£‡∏Å:', csvText.substring(0, 500));
                        
                        if (csvText.length > 100 && !csvText.includes('<!DOCTYPE html')) {
                            allDailyData = parseCSVData(csvText);
                            
                            if (allDailyData.length > 0) {
                                productsData = {
                                    '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì': {
                                        name: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
                                        dailyData: allDailyData,
                                        totals: calculateTotals(allDailyData)
                                    }
                                };
                                
                                updateDashboard();
                                document.getElementById('lastUpdated').textContent = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${new Date().toLocaleString('th-TH')}`;
                                console.log('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô CSV ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                                return;
                            }
                        }
                    } else {
                        console.log('‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö CSV ‡πÑ‡∏°‡πà OK:', response.status, response.statusText);
                    }
                } catch (csvError) {
                    console.log('‡∏ß‡∏¥‡∏ò‡∏µ CSV ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', csvError.message);
                }
                
                // Method 2: Try JSON API with better error handling
                try {
                    const jsonUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&cachebust=${Date.now()}`;
                    console.log('‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ JSON:', jsonUrl);
                    
                    const response = await fetch(jsonUrl, {
                        method: 'GET',
                        mode: 'cors',
                        cache: 'no-cache'
                    });
                    
                    if (response.ok) {
                        const text = await response.text();
                        console.log('‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö JSON ‡πÅ‡∏•‡πâ‡∏ß, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß:', text.length);
                        
                        if (text.includes('google.visualization.Query.setResponse')) {
                            const jsonText = text.substring(47).slice(0, -2);
                            const data = JSON.parse(jsonText);
                            
                            console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:', data);
                            
                            if (data.table && data.table.rows) {
                                allDailyData = parseSheetData(data.table.rows, data.table.cols);
                                
                                if (allDailyData.length > 0) {
                                    productsData = {
                                        '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì': {
                                            name: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
                                            dailyData: allDailyData,
                                            totals: calculateTotals(allDailyData)
                                        }
                                    };
                                    
                                    updateDashboard();
                                    document.getElementById('lastUpdated').textContent = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${new Date().toLocaleString('th-TH')}`;
                                    console.log('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô JSON ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                                    return;
                                }
                            }
                        }
                    } else {
                        console.log('‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö JSON ‡πÑ‡∏°‡πà OK:', response.status, response.statusText);
                    }
                } catch (jsonError) {
                    console.log('‡∏ß‡∏¥‡∏ò‡∏µ JSON ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', jsonError.message);
                }
                
                // Method 3: Try direct sheet access with different parameters
                try {
                    const directUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tq=SELECT%20*&tqx=out:json&sheet=Sheet1`;
                    console.log('‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏£‡∏á:', directUrl);
                    
                    const response = await fetch(directUrl, {
                        method: 'GET',
                        mode: 'cors'
                    });
                    
                    if (response.ok) {
                        const text = await response.text();
                        if (text.includes('google.visualization.Query.setResponse')) {
                            const jsonText = text.substring(47).slice(0, -2);
                            const data = JSON.parse(jsonText);
                            
                            if (data.table && data.table.rows) {
                                allDailyData = parseSheetData(data.table.rows, data.table.cols);
                                
                                if (allDailyData.length > 0) {
                                    productsData = {
                                        '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì': {
                                            name: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
                                            dailyData: allDailyData,
                                            totals: calculateTotals(allDailyData)
                                        }
                                    };
                                    
                                    updateDashboard();
                                    document.getElementById('lastUpdated').textContent = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${new Date().toLocaleString('th-TH')}`;
                                    console.log('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏£‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                                    return;
                                }
                            }
                        }
                    }
                } catch (directError) {
                    console.log('‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏£‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', directError.message);
                }
                
                // If all methods fail, throw error with specific guidance
                throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Google Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡πÑ‡∏î‡πâ"');
                
            } catch (error) {
                console.error('‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error);
                throw new Error(`‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`);
            }
        }

        function parseCSVData(csvText) {
            const lines = csvText.split('\n');
            const dailyData = [];
            
            console.log('üîç ‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:', lines.length);
            console.log('üìã ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 5 ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å:');
            for (let i = 0; i < Math.min(5, lines.length); i++) {
                console.log(`‡πÅ‡∏ñ‡∏ß ${i}:`, lines[i].substring(0, 200) + '...');
            }
            
            // Skip header rows and start from row 3 (index 2) - where daily data begins
            for (let i = 2; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // Parse CSV line (handle quoted values)
                const values = parseCSVLine(line);
                console.log(`üìä ‡πÅ‡∏ñ‡∏ß ${i+1} - ‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏î‡πâ ${values.length} ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå`);
                
                if (values.length < 15) {
                    console.log(`‚ö†Ô∏è ‡πÅ‡∏ñ‡∏ß ${i+1} ‡∏Ç‡πâ‡∏≤‡∏° - ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (${values.length})`);
                    continue;
                }
                
                try {
                    // EXACT COLUMN MAPPING based on your sheet structure:
                    const dateStr = values[0]; // Column A: Date
                    
                    // Key metrics from specific columns:
                    const orders = parseFloat(values[10]) || 0;        // Column K: Number of orders
                    const items = parseFloat(values[11]) || 0;         // Column L: Number of items sold  
                    const sales = parseFloat(values[12]) || 0;         // Column M: Total sales
                    const adsCost = parseFloat(values[22]) || 0;       // Column W: Ads cost
                    const avgAdsPerOrder = parseFloat(values[26]) || 0; // Column AA: Average Ads per order
                    const vat = parseFloat(values[30]) || 0;           // Column AE: VAT to pay
                    const profit = parseFloat(values[32]) || 0;        // Column AG: Actual profit/loss
                    
                    console.log(`üìà ‡πÅ‡∏ñ‡∏ß ${i+1} ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î:`, {
                        date: dateStr,
                        orders: orders,
                        items: items, 
                        sales: sales,
                        adsCost: adsCost,
                        avgAdsPerOrder: avgAdsPerOrder,
                        vat: vat,
                        profit: profit
                    });
                    
                    // ENHANCED DATE PARSING - Handle multiple formats and convert to YYYY-MM-DD
                    let formattedDate = null;
                    if (dateStr && dateStr.trim()) {
                        const cleanDate = dateStr.trim().replace(/"/g, '');
                        console.log(`üóìÔ∏è ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: "${cleanDate}"`);
                        
                        let parsedDate = null;
                        
                        // PRIMARY FORMAT: DD/MM/YYYY (your Google Sheet format)
                        if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(cleanDate)) {
                            const parts = cleanDate.split('/');
                            const day = parseInt(parts[0], 10);
                            const month = parseInt(parts[1], 10);
                            const year = parseInt(parts[2], 10);
                            
                            console.log(`üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ‡∏ß‡∏±‡∏ô=${day}, ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô=${month}, ‡∏õ‡∏µ=${year}`);
                            
                            // Validate date components - expanded year range for 2025
                            if (day >= 1 && day <= 31 && month >= 1 && month <= 12 && year >= 2020 && year <= 2030) {
                                parsedDate = new Date(year, month - 1, day);
                                console.log(`üóìÔ∏è ‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå DD/MM/YYYY: ${cleanDate} ‚Üí ‡∏ß‡∏±‡∏ô=${day}, ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô=${month}, ‡∏õ‡∏µ=${year} ‚Üí ${parsedDate.toDateString()}`);
                            } else {
                                console.warn(`‚ùå ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏ß‡∏±‡∏ô=${day}, ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô=${month}, ‡∏õ‡∏µ=${year}`);
                            }
                        }
                        
                        // SECONDARY FORMAT: DD-MM-YYYY
                        if (!parsedDate && /^\d{1,2}-\d{1,2}-\d{4}$/.test(cleanDate)) {
                            const parts = cleanDate.split('-');
                            const day = parseInt(parts[0], 10);
                            const month = parseInt(parts[1], 10);
                            const year = parseInt(parts[2], 10);
                            
                            if (day >= 1 && day <= 31 && month >= 1 && month <= 12 && year >= 2020 && year <= 2030) {
                                parsedDate = new Date(year, month - 1, day);
                                console.log(`üóìÔ∏è ‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå DD-MM-YYYY: ${cleanDate}`);
                            }
                        }
                        
                        // FALLBACK FORMAT: ISO format (YYYY-MM-DD)
                        if (!parsedDate && /^\d{4}-\d{2}-\d{2}$/.test(cleanDate)) {
                            parsedDate = new Date(cleanDate + 'T12:00:00');
                            console.log(`üóìÔ∏è ‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ISO: ${cleanDate}`);
                        }
                        
                        // FALLBACK: Try Excel date number format
                        if (!parsedDate && /^\d+$/.test(cleanDate)) {
                            const excelDate = parseInt(cleanDate, 10);
                            if (excelDate > 40000 && excelDate < 50000) { // Reasonable range for 2009-2037
                                parsedDate = new Date((excelDate - 25569) * 86400 * 1000);
                                console.log(`üóìÔ∏è ‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Excel date number: ${cleanDate}`);
                            }
                        }
                        
                        // Validate the parsed date and convert to YYYY-MM-DD format
                        if (parsedDate && !isNaN(parsedDate.getTime()) && parsedDate.getFullYear() >= 2020 && parsedDate.getFullYear() <= 2030) {
                            // Always convert to YYYY-MM-DD format for consistent comparison
                            const year = parsedDate.getFullYear();
                            const month = String(parsedDate.getMonth() + 1).padStart(2, '0');
                            const day = String(parsedDate.getDate()).padStart(2, '0');
                            formattedDate = `${year}-${month}-${day}`;
                            
                            console.log(`‚úÖ ‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: "${cleanDate}" ‚Üí ${formattedDate} (${parsedDate.toDateString()})`);
                        } else {
                            console.warn(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: "${cleanDate}" - ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏õ‡∏µ 2020-2030`);
                            continue;
                        }
                    } else {
                        console.warn(`‚ùå ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß ${i+1}`);
                        continue;
                    }
                    
                    // Enhanced data validation - include rows with ANY meaningful data
                    const hasData = orders > 0 || items > 0 || sales > 0 || adsCost > 0 || vat > 0 || Math.abs(profit) > 0;
                    
                    if (formattedDate && hasData) {
                        const dataPoint = {
                            date: formattedDate, // Now always in YYYY-MM-DD format
                            orders: orders,
                            items: items,
                            sales: sales,
                            adsCost: adsCost,
                            avgAdsPerOrder: avgAdsPerOrder,
                            vat: vat,
                            profit: profit
                        };
                        
                        console.log(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${formattedDate}:`, dataPoint);
                        dailyData.push(dataPoint);
                    } else if (formattedDate) {
                        console.log(`‚ö†Ô∏è ‡πÅ‡∏ñ‡∏ß ${i+1} ‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ - ‡∏Ç‡πâ‡∏≤‡∏°`);
                    }
                } catch (parseError) {
                    console.warn('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ñ‡∏ß CSV:', i, parseError);
                }
            }
            
            console.log(`üéØ ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô - ‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ${dailyData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
            
            if (dailyData.length === 0) {
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô CSV');
                console.log('üîß ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤:');
                console.log('1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß 3');
                console.log('2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå K, L, M, W, AA, AE, AG ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç');
                console.log('3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A ‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö DD/MM/YYYY ‡∏´‡∏£‡∏∑‡∏≠ DD-MM-YYYY');
                console.log('4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ sheet ‡∏ñ‡∏π‡∏Å‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡πÑ‡∏î‡πâ"');
                return [];
            }
            
            // Sort by date and show summary
            const sortedData = dailyData.sort((a, b) => new Date(a.date) - new Date(b.date));
            console.log(`üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${sortedData.length} ‡∏ß‡∏±‡∏ô ‡∏à‡∏≤‡∏Å ${sortedData[0]?.date} ‡∏ñ‡∏∂‡∏á ${sortedData[sortedData.length-1]?.date}`);
            
            return sortedData;
        }

        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    values.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            values.push(current.trim());
            return values;
        }

        function loadDemoData() {
            console.log('üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö');
            console.log(`üóìÔ∏è ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${currentStartDate} ‡∏ñ‡∏∂‡∏á ${currentEndDate}`);
            
            const productAData = generateSampleData('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ A');
            const productBData = generateSampleData('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ B');
            
            console.log('üìä ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ A:', productAData.length, '‡∏ß‡∏±‡∏ô');
            console.log('üìä ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ B:', productBData.length, '‡∏ß‡∏±‡∏ô');
            
            // Show date ranges for debugging
            if (productAData.length > 0) {
                console.log(`üìÖ ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ A: ${productAData[0].date} ‡∏ñ‡∏∂‡∏á ${productAData[productAData.length-1].date}`);
            }
            if (productBData.length > 0) {
                console.log(`üìÖ ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ B: ${productBData[0].date} ‡∏ñ‡∏∂‡∏á ${productBData[productBData.length-1].date}`);
            }
            
            productsData = {
                '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ A': {
                    name: '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ A',
                    dailyData: productAData,
                    totals: calculateTotals(productAData)
                },
                '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ B': {
                    name: '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ B', 
                    dailyData: productBData,
                    totals: calculateTotals(productBData)
                }
            };
            
            // Store all daily data for filtering
            allDailyData = [...productAData, ...productBData];
            
            console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            console.log('üìà ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:', Object.keys(productsData));
            console.log('üìä ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:', allDailyData.length);
            
            // Update connection status
            updateConnectionStatus('connected', '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß');
            enableButtons();
            
            // Update dashboard immediately with current date range
            console.log('üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏•‡∏≠‡∏á...');
            updateDashboard();
            document.getElementById('lastUpdated').textContent = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${new Date().toLocaleString('th-TH')} (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏•‡∏≠‡∏á)`;
        }

        function generateSampleData(productName) {
            const baseMultiplier = productName === '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ A' ? 1.5 : productName === '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ B' ? 1.2 : 0.8;
            const data = [];
            
            // Generate data for the current month to match default date range
            const today = new Date();
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            console.log(`üîÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${productName} ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô`);
            console.log(`üóìÔ∏è ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${startOfMonth.toDateString()} ‡∏ñ‡∏∂‡∏á ${endOfMonth.toDateString()}`);
            
            // Generate data for each day of the current month
            const currentDate = new Date(startOfMonth);
            while (currentDate <= endOfMonth) {
                const dateStr = currentDate.toISOString().split('T')[0];
                
                // Generate realistic sample data
                const orders = Math.floor((15 + Math.random() * 25) * baseMultiplier);
                const items = Math.floor(orders * (1.1 + Math.random() * 0.7));
                const sales = Math.floor((orders * 380 + Math.random() * 4000) * baseMultiplier);
                const adsCost = Math.floor((orders * 22 + Math.random() * 800) * baseMultiplier);
                const vat = Math.floor(sales * 0.07);
                const profit = Math.floor(sales * 0.28 - adsCost - vat);
                
                console.log(`üìÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${dateStr}: ${orders} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå, ${sales} ‡∏ö‡∏≤‡∏ó ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢`);
                
                data.push({
                    date: dateStr,
                    orders: orders,
                    items: items,
                    sales: sales,
                    adsCost: adsCost,
                    avgAdsPerOrder: Math.round(adsCost / orders),
                    vat: vat,
                    profit: profit
                });
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            console.log(`‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${data.length} ‡∏ß‡∏±‡∏ô ‡∏à‡∏≤‡∏Å ${data[0]?.date} ‡∏ñ‡∏∂‡∏á ${data[data.length-1]?.date}`);
            return data;
        }

        function parseSheetData(rows, cols) {
            const dailyData = [];
            
            // Parse data starting from row 3 (index 2)
            for (let i = 2; i < rows.length; i++) { // Start from row 3 (index 2)
                const row = rows[i];
                if (!row.c || !row.c[0] || !row.c[0].v) continue; // Skip empty rows
                
                try {
                    // Map to your exact sheet structure
                    const date = row.c[0] ? (row.c[0].f || row.c[0].v) : null; // A3: Date
                    const orders = row.c[10] ? (row.c[10].v || 0) : 0; // K3: Number of orders
                    const items = row.c[11] ? (row.c[11].v || 0) : 0; // L3: Number of items sold
                    const sales = row.c[12] ? (row.c[12].v || 0) : 0; // M3: Total sales
                    const adsCost = row.c[22] ? (row.c[22].v || 0) : 0; // W3: Ads cost
                    const avgAdsPerOrder = row.c[26] ? (row.c[26].v || 0) : 0; // AA3: Average Ads per order
                    const vatToPay = row.c[30] ? (row.c[30].v || 0) : 0; // AE3: VAT to pay
                    const profit = row.c[32] ? (row.c[32].v || 0) : 0; // AG3: Actual profit/loss
                    
                    // Convert date if it's a number (Excel date format)
                    let formattedDate = date;
                    if (typeof date === 'number') {
                        const excelDate = new Date((date - 25569) * 86400 * 1000);
                        formattedDate = excelDate.toISOString().split('T')[0];
                    } else if (typeof date === 'string') {
                        // Try to parse the date string
                        const parsedDate = new Date(date);
                        if (!isNaN(parsedDate.getTime())) {
                            formattedDate = parsedDate.toISOString().split('T')[0];
                        }
                    }
                    
                    dailyData.push({
                        date: formattedDate,
                        orders: Number(orders) || 0,
                        items: Number(items) || 0,
                        sales: Number(sales) || 0,
                        adsCost: Number(adsCost) || 0,
                        avgAdsPerOrder: Number(avgAdsPerOrder) || 0,
                        vat: Number(vatToPay) || 0,
                        profit: Number(profit) || 0
                    });
                } catch (error) {
                    console.warn('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ñ‡∏ß:', i, error);
                }
            }
            
            // If no data found, generate sample data
            if (dailyData.length === 0) {
                return generateSampleData('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å');
            }
            
            // Sort by date and return all data (not just last 7 days)
            return dailyData.sort((a, b) => new Date(a.date) - new Date(b.date));
        }

        function calculateTotals(dailyData) {
            return dailyData.reduce((acc, day) => {
                acc.orders += day.orders;
                acc.items += day.items;
                acc.sales += day.sales;
                acc.adsCost += day.adsCost;
                acc.vat += day.vat;
                acc.profit += day.profit;
                return acc;
            }, { orders: 0, items: 0, sales: 0, adsCost: 0, vat: 0, profit: 0 });
        }

        function addNewProduct(productName) {
            if (productsData[productName]) {
                alert('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
                return;
            }
            
            productsData[productName] = {
                name: productName,
                dailyData: generateSampleData(productName),
                totals: calculateTotals(generateSampleData(productName))
            };
            
            updateDashboard();
            alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ "${productName}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á sheet ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô Google Sheets ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì`);
        }

        function updateConnectionStatus(status, text) {
            const statusIndicator = document.getElementById('connectionStatus');
            const connectionText = document.getElementById('connectionText');
            
            statusIndicator.className = `status-indicator status-${status}`;
            connectionText.textContent = text;
            
            isConnected = status === 'connected';
        }

        function enableButtons() {
            document.getElementById('refreshBtn').disabled = false;
            document.getElementById('diagnosticBtn').disabled = false;
            document.getElementById('addProductBtn').disabled = false;
            document.getElementById('exportBtn').disabled = false;
            document.getElementById('filterBtn').disabled = false;
            document.getElementById('quickRangeBtn').disabled = false;
        }

        function updateDateRangeDisplay() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const daysDiff = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                
                document.getElementById('selectedDaysCount').textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${daysDiff} ‡∏ß‡∏±‡∏ô`;
                
                if (startDate === endDate) {
                    const thaiDate = formatDateThai(startDate);
                    document.getElementById('dateRangeDisplay').textContent = thaiDate;
                    document.getElementById('summaryPeriod').textContent = thaiDate;
                } else {
                    const startThai = formatDateThai(startDate);
                    const endThai = formatDateThai(endDate);
                    document.getElementById('dateRangeDisplay').textContent = `${startThai} - ${endThai}`;
                    document.getElementById('summaryPeriod').textContent = `${startThai} - ${endThai}`;
                }
                
                document.getElementById('trendChartPeriod').textContent = `(${daysDiff} ‡∏ß‡∏±‡∏ô)`;
            }
        }

        function getDataInRange(dailyData, startDate, endDate) {
            console.log(`üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${startDate} ‡∏ñ‡∏∂‡∏á ${endDate}`);
            console.log(`üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≠‡∏ô: ${dailyData.length} ‡∏ß‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ`);
            
            if (!dailyData || dailyData.length === 0) {
                console.warn('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á');
                return [];
            }
            
            // Show ALL available dates for debugging
            console.log('üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:');
            dailyData.forEach((day, index) => {
                console.log(`  ${index + 1}. ${day.date} (‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå: ${day.orders}, ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: ${day.sales})`);
            });
            
            console.log(`üéØ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏≠‡∏á‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á ${startDate} ‡πÅ‡∏•‡∏∞ ${endDate}`);
            console.log(`üìù ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${dailyData[0]?.date} (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)`);
            
            // Convert filter dates to Date objects for proper comparison
            const filterStartDate = new Date(startDate + 'T00:00:00');
            const filterEndDate = new Date(endDate + 'T23:59:59');
            
            console.log(`üìÖ ‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á: ${filterStartDate.toDateString()} ‡∏ñ‡∏∂‡∏á ${filterEndDate.toDateString()}`);
            
            const filteredData = dailyData.filter(day => {
                if (!day.date) {
                    console.warn('‚ö†Ô∏è ‡∏Ç‡πâ‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:', day);
                    return false;
                }
                
                // Convert day.date to Date object for comparison
                let dayDate = null;
                
                // Handle YYYY-MM-DD format (already converted in parseCSVData)
                if (/^\d{4}-\d{2}-\d{2}$/.test(day.date)) {
                    dayDate = new Date(day.date + 'T12:00:00');
                }
                // Handle DD/MM/YYYY format (if somehow still in original format)
                else if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(day.date)) {
                    const parts = day.date.split('/');
                    const dayNum = parseInt(parts[0], 10);
                    const month = parseInt(parts[1], 10);
                    const year = parseInt(parts[2], 10);
                    dayDate = new Date(year, month - 1, dayNum, 12, 0, 0);
                }
                
                if (!dayDate || isNaN(dayDate.getTime())) {
                    console.warn(`‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${day.date}`);
                    return false;
                }
                
                // Check if day falls within the range
                const isInRange = dayDate >= filterStartDate && dayDate <= filterEndDate;
                
                if (isInRange) {
                    console.log(`‚úÖ ‡∏£‡∏ß‡∏° ${day.date} (${dayDate.toDateString()}):`, {
                        orders: day.orders || 0,
                        items: day.items || 0,
                        sales: day.sales || 0,
                        adsCost: day.adsCost || 0,
                        avgAdsPerOrder: day.avgAdsPerOrder || 0,
                        vat: day.vat || 0,
                        profit: day.profit || 0
                    });
                } else {
                    console.log(`‚ùå ‡∏Ç‡πâ‡∏≤‡∏° ${day.date} (${dayDate.toDateString()}) - ‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á`);
                }
                
                return isInRange;
            });
            
            console.log(`üéØ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á: ${filteredData.length} ‡∏ß‡∏±‡∏ô ‡∏à‡∏≤‡∏Å ${dailyData.length} ‡∏ß‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î`);
            
            if (filteredData.length === 0) {
                console.warn('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å');
                console.warn('üìã ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:');
                dailyData.forEach(day => {
                    let displayDate = day.date;
                    if (/^\d{4}-\d{2}-\d{2}$/.test(day.date)) {
                        const date = new Date(day.date + 'T12:00:00');
                        displayDate = `${day.date} (${date.toDateString()})`;
                    }
                    console.warn(`  - ${displayDate}`);
                });
                console.warn(`üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏≠‡∏á‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á ${filterStartDate.toDateString()} ‡πÅ‡∏•‡∏∞ ${filterEndDate.toDateString()}`);
            }
            
            return filteredData;
        }

        function aggregateRangeData(rangeData) {
            console.log(`üìä ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${rangeData.length} ‡∏ß‡∏±‡∏ô`);
            
            if (!rangeData || rangeData.length === 0) {
                console.warn('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏£‡∏ß‡∏°');
                return { orders: 0, items: 0, sales: 0, adsCost: 0, avgAdsPerOrder: 0, vat: 0, profit: 0 };
            }
            
            const totals = rangeData.reduce((acc, day, index) => {
                const dayOrders = Number(day.orders) || 0;
                const dayItems = Number(day.items) || 0;
                const daySales = Number(day.sales) || 0;
                const dayAdsCost = Number(day.adsCost) || 0;
                const dayVat = Number(day.vat) || 0;
                const dayProfit = Number(day.profit) || 0;
                
                console.log(`  ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${index + 1} (${day.date}): ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå=${dayOrders}, ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤=${dayItems}, ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢=${daySales}, ‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤=${dayAdsCost}, VAT=${dayVat}, ‡∏Å‡∏≥‡πÑ‡∏£=${dayProfit}`);
                
                acc.orders += dayOrders;
                acc.items += dayItems;
                acc.sales += daySales;
                acc.adsCost += dayAdsCost;
                acc.vat += dayVat;
                acc.profit += dayProfit;
                
                return acc;
            }, { orders: 0, items: 0, sales: 0, adsCost: 0, vat: 0, profit: 0 });
            
            // Calculate average ads per order for the aggregated data
            totals.avgAdsPerOrder = totals.orders > 0 ? Math.round(totals.adsCost / totals.orders) : 0;
            
            console.log(`üéØ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°:`, {
                orders: totals.orders,
                items: totals.items,
                sales: totals.sales,
                adsCost: totals.adsCost,
                avgAdsPerOrder: totals.avgAdsPerOrder,
                vat: totals.vat,
                profit: totals.profit
            });
            
            return totals;
        }

        function updateDashboard() {
            console.log('üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î');
            console.log('üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ:', !!productsData);
            console.log('üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:', Object.keys(productsData || {}).length);
            
            try {
                console.log('1Ô∏è‚É£ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°...');
                updateOverallSummary();
                
                console.log('2Ô∏è‚É£ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô...');
                updateDailyBreakdown();
                
                console.log('3Ô∏è‚É£ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...');
                updateProductCards();
                
                console.log('4Ô∏è‚É£ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü...');
                updateCharts();
                
                console.log('5Ô∏è‚É£ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...');
                updateProductTable();
                
                console.log('‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô');
            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î:', error);
                console.error('Stack trace:', error.stack);
            }
        }

        function updateOverallSummary() {
            console.log('üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°');
            console.log(`üìÖ ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${currentStartDate} ‡∏ñ‡∏∂‡∏á ${currentEndDate}`);
            
            // Validate that we have data to work with
            if (!productsData || Object.keys(productsData).length === 0) {
                console.warn('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå');
                setZeroValues();
                return;
            }
            
            console.log('üìä ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ:', Object.keys(productsData));
            
            // Get all daily data from all products within the selected range
            let allRangeData = [];
            let totalDaysFound = 0;
            
            Object.values(productsData).forEach(product => {
                console.log(`üîç ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${product.name}`);
                console.log(`üìä ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${product.dailyData?.length || 0} ‡∏ß‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î`);
                
                if (!product.dailyData || product.dailyData.length === 0) {
                    console.warn(`‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${product.name}`);
                    return;
                }
                
                // Show sample of product data
                if (product.dailyData.length > 0) {
                    console.log(`üìà ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ${product.name}:`, product.dailyData[0]);
                }
                
                const rangeData = getDataInRange(product.dailyData, currentStartDate, currentEndDate);
                console.log(`‚úÖ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${product.name}: ${rangeData.length} ‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å`);
                
                totalDaysFound += rangeData.length;
                allRangeData = allRangeData.concat(rangeData);
            });
            
            console.log(`üìä ‡∏à‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${allRangeData.length} ‡∏à‡∏≤‡∏Å ${totalDaysFound} ‡∏ß‡∏±‡∏ô`);
            
            if (allRangeData.length === 0) {
                console.warn('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å - ‡πÅ‡∏™‡∏î‡∏á‡∏®‡∏π‡∏ô‡∏¢‡πå');
                setZeroValues();
                return;
            }
            
            // Use the improved aggregation function
            const overallTotals = aggregateRangeData(allRangeData);
            
            console.log('üéØ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢:', overallTotals);
            
            // Update display with proper formatting and validation
            try {
                document.getElementById('totalOrders').textContent = (overallTotals.orders || 0).toLocaleString('th-TH');
                document.getElementById('totalItems').textContent = (overallTotals.items || 0).toLocaleString('th-TH');
                document.getElementById('totalSales').textContent = (overallTotals.sales || 0).toLocaleString('th-TH') + ' ‡∏ö‡∏≤‡∏ó';
                document.getElementById('totalAds').textContent = (overallTotals.adsCost || 0).toLocaleString('th-TH') + ' ‡∏ö‡∏≤‡∏ó';
                document.getElementById('avgAdsPerOrder').textContent = (overallTotals.avgAdsPerOrder || 0).toLocaleString('th-TH') + ' ‡∏ö‡∏≤‡∏ó';
                document.getElementById('totalVAT').textContent = (overallTotals.vat || 0).toLocaleString('th-TH') + ' ‡∏ö‡∏≤‡∏ó';
                document.getElementById('totalProfit').textContent = (overallTotals.profit || 0).toLocaleString('th-TH') + ' ‡∏ö‡∏≤‡∏ó';

                // Update profit card styling based on profit/loss
                const profitCard = document.getElementById('totalProfitCard');
                const profitElement = document.getElementById('totalProfit');
                
                if ((overallTotals.profit || 0) >= 0) {
                    profitCard.className = 'rounded-lg p-4 card-shadow text-center bg-green-100 border-l-4 border-green-500';
                    profitElement.className = 'text-xl font-bold text-green-600';
                } else {
                    profitCard.className = 'rounded-lg p-4 card-shadow text-center bg-red-100 border-l-4 border-red-500';
                    profitElement.className = 'text-xl font-bold text-red-600';
                }

                // Update product count and date range info
                document.getElementById('productCount').textContent = Object.keys(productsData).length;
                
                // Update period display with day count
                const startDate = new Date(currentStartDate);
                const endDate = new Date(currentEndDate);
                const dayCount = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                
                if (dayCount === 1) {
                    document.getElementById('summaryPeriod').textContent = formatDateThai(currentStartDate);
                } else {
                    document.getElementById('summaryPeriod').textContent = 
                        `${formatDateThai(currentStartDate)} - ${formatDateThai(currentEndDate)} (${dayCount} ‡∏ß‡∏±‡∏ô)`;
                }
                
                console.log('‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô');
                console.log(`üìà ‡πÅ‡∏™‡∏î‡∏á: ${overallTotals.orders} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå, ${overallTotals.sales} ‡∏ö‡∏≤‡∏ó ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢, ${overallTotals.profit} ‡∏ö‡∏≤‡∏ó ‡∏Å‡∏≥‡πÑ‡∏£`);
            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ:', error);
                setZeroValues();
            }
        }

        function setZeroValues() {
            console.log('üîÑ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î');
            try {
                document.getElementById('totalOrders').textContent = '0';
                document.getElementById('totalItems').textContent = '0';
                document.getElementById('totalSales').textContent = '0 ‡∏ö‡∏≤‡∏ó';
                document.getElementById('totalAds').textContent = '0 ‡∏ö‡∏≤‡∏ó';
                document.getElementById('avgAdsPerOrder').textContent = '0 ‡∏ö‡∏≤‡∏ó';
                document.getElementById('totalVAT').textContent = '0 ‡∏ö‡∏≤‡∏ó';
                document.getElementById('totalProfit').textContent = '0 ‡∏ö‡∏≤‡∏ó';
                
                const profitCard = document.getElementById('totalProfitCard');
                profitCard.className = 'rounded-lg p-4 card-shadow text-center bg-gray-100';
                
                document.getElementById('productCount').textContent = '0';
                document.getElementById('summaryPeriod').textContent = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏®‡∏π‡∏ô‡∏¢‡πå:', error);
            }
        }

        function updateDailyBreakdown() {
            console.log('üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô');
            console.log(`üìÖ ‡∏ä‡πà‡∏ß‡∏á: ${currentStartDate} ‡∏ñ‡∏∂‡∏á ${currentEndDate}`);
            
            const tableBody = document.getElementById('dailyBreakdownTable');
            const tableFooter = document.getElementById('dailyBreakdownFooter');
            
            // Validate data availability
            if (!productsData || Object.keys(productsData).length === 0) {
                console.warn('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î');
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-8 text-gray-500">
                            ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                        </td>
                    </tr>
                `;
                tableFooter.classList.add('hidden');
                document.getElementById('dailyBreakdownCount').textContent = '0';
                return;
            }
            
            // Get all data in the selected range from all products
            let allRangeData = [];
            Object.values(productsData).forEach(product => {
                const rangeData = getDataInRange(product.dailyData, currentStartDate, currentEndDate);
                console.log(`üìä ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${product.name}: ${rangeData.length} ‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î`);
                allRangeData = allRangeData.concat(rangeData);
            });
            
            console.log(`üìä ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${allRangeData.length} ‡∏à‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•`);
            
            if (allRangeData.length === 0) {
                console.warn('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î');
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-8 text-gray-500">
                            ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                        </td>
                    </tr>
                `;
                tableFooter.classList.add('hidden');
                document.getElementById('dailyBreakdownCount').textContent = '0';
                return;
            }
            
            // Group by date and aggregate across all products for each day
            const dailyTotals = {};
            allRangeData.forEach(day => {
                const dateKey = day.date.split('T')[0]; // Normalize date key
                
                if (!dailyTotals[dateKey]) {
                    dailyTotals[dateKey] = {
                        date: dateKey,
                        orders: 0,
                        items: 0,
                        sales: 0,
                        adsCost: 0,
                        vat: 0,
                        profit: 0
                    };
                }
                
                // Safely add values with proper number conversion
                dailyTotals[dateKey].orders += Number(day.orders) || 0;
                dailyTotals[dateKey].items += Number(day.items) || 0;
                dailyTotals[dateKey].sales += Number(day.sales) || 0;
                dailyTotals[dateKey].adsCost += Number(day.adsCost) || 0;
                dailyTotals[dateKey].vat += Number(day.vat) || 0;
                dailyTotals[dateKey].profit += Number(day.profit) || 0;
                
                console.log(`üìà ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô ${dateKey}: ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå=${day.orders}, ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢=${day.sales}, ‡∏Å‡∏≥‡πÑ‡∏£=${day.profit}`);
            });
            
            const sortedDays = Object.values(dailyTotals).sort((a, b) => new Date(a.date) - new Date(b.date));
            console.log(`üìä ‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${sortedDays.length} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥`);
            
            // Update table body with daily breakdown
            tableBody.innerHTML = sortedDays.map(day => {
                const avgAdsPerOrder = day.orders > 0 ? Math.round(day.adsCost / day.orders) : 0;
                console.log(`üìã ‡πÅ‡∏ñ‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${day.date}: ${day.orders} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå, ${day.sales} ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢, ${day.profit} ‡∏Å‡∏≥‡πÑ‡∏£`);
                
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-2 font-medium">${formatDateThai(day.date)}</td>
                        <td class="text-right py-2">${day.orders.toLocaleString('th-TH')}</td>
                        <td class="text-right py-2">${day.items.toLocaleString('th-TH')}</td>
                        <td class="text-right py-2">${day.sales.toLocaleString('th-TH')}</td>
                        <td class="text-right py-2">${day.adsCost.toLocaleString('th-TH')}</td>
                        <td class="text-right py-2">${avgAdsPerOrder.toLocaleString('th-TH')}</td>
                        <td class="text-right py-2">${day.vat.toLocaleString('th-TH')}</td>
                        <td class="text-right py-2 font-semibold ${day.profit >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${day.profit.toLocaleString('th-TH')}
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Calculate and update footer totals (sum of all days)
            const totals = sortedDays.reduce((acc, day) => {
                acc.orders += day.orders;
                acc.items += day.items;
                acc.sales += day.sales;
                acc.adsCost += day.adsCost;
                acc.vat += day.vat;
                acc.profit += day.profit;
                return acc;
            }, { orders: 0, items: 0, sales: 0, adsCost: 0, vat: 0, profit: 0 });
            
            const totalAvgAdsPerOrder = totals.orders > 0 ? Math.round(totals.adsCost / totals.orders) : 0;
            
            console.log('üéØ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡πâ‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:', totals);
            
            document.getElementById('footerOrders').textContent = totals.orders.toLocaleString('th-TH');
            document.getElementById('footerItems').textContent = totals.items.toLocaleString('th-TH');
            document.getElementById('footerSales').textContent = totals.sales.toLocaleString('th-TH');
            document.getElementById('footerAds').textContent = totals.adsCost.toLocaleString('th-TH');
            document.getElementById('footerAvgPerOrder').textContent = totalAvgAdsPerOrder.toLocaleString('th-TH');
            document.getElementById('footerVAT').textContent = totals.vat.toLocaleString('th-TH');
            document.getElementById('footerProfit').textContent = totals.profit.toLocaleString('th-TH');
            document.getElementById('footerProfit').className = `text-right py-3 font-semibold ${totals.profit >= 0 ? 'text-green-600' : 'text-red-600'}`;
            
            tableFooter.classList.remove('hidden');
            document.getElementById('dailyBreakdownCount').textContent = sortedDays.length;
            
            console.log('‚úÖ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô');
            console.log(`üìä ‡πÅ‡∏™‡∏î‡∏á ${sortedDays.length} ‡∏ß‡∏±‡∏ô ‡∏î‡πâ‡∏ß‡∏¢‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${totals.orders} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå, ${totals.sales} ‡∏ö‡∏≤‡∏ó ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢`);
        }

        function updateProductCards() {
            const container = document.getElementById('productCards');
            container.innerHTML = '';

            Object.values(productsData).forEach(product => {
                const rangeData = getDataInRange(product.dailyData, currentStartDate, currentEndDate);
                const aggregated = aggregateRangeData(rangeData);
                
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-xl font-bold">${product.name}</h3>
                        <div class="text-sm opacity-75">${rangeData.length} ‡∏ß‡∏±‡∏ô</div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <div class="opacity-75">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>
                            <div class="text-lg font-bold">${aggregated.orders.toLocaleString('th-TH')}</div>
                        </div>
                        <div>
                            <div class="opacity-75">‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                            <div class="text-lg font-bold">${aggregated.items.toLocaleString('th-TH')}</div>
                        </div>
                        <div>
                            <div class="opacity-75">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</div>
                            <div class="text-lg font-bold">${aggregated.sales.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div>
                            <div class="opacity-75">‡∏Å‡∏≥‡πÑ‡∏£</div>
                            <div class="text-lg font-bold ${aggregated.profit >= 0 ? 'text-green-200' : 'text-red-200'}">
                                ${aggregated.profit.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-white border-opacity-20">
                        <div class="flex justify-between text-sm">
                            <span class="opacity-75">‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤:</span>
                            <span>${aggregated.adsCost.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="opacity-75">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå:</span>
                            <span>${Math.round(aggregated.adsCost / aggregated.orders || 0)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function updateCharts() {
            updateSalesTrendChart();
            updateProductOrdersChart();
            updateCostDistributionChart();
            updateProfitByProductChart();
        }

        function updateSalesTrendChart() {
            const ctx = document.getElementById('salesTrendChart').getContext('2d');
            if (charts.salesTrend) charts.salesTrend.destroy();

            console.log('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á:', currentStartDate, '‡∏ñ‡∏∂‡∏á', currentEndDate);

            // Get range data for all products and aggregate by date
            let allRangeData = [];
            Object.values(productsData).forEach(product => {
                const rangeData = getDataInRange(product.dailyData, currentStartDate, currentEndDate);
                allRangeData = allRangeData.concat(rangeData);
            });

            // Group by date and aggregate across all products
            const dailyTotals = {};
            allRangeData.forEach(day => {
                if (!dailyTotals[day.date]) {
                    dailyTotals[day.date] = {
                        date: day.date,
                        orders: 0,
                        sales: 0,
                        adsCost: 0,
                        profit: 0
                    };
                }
                dailyTotals[day.date].orders += day.orders || 0;
                dailyTotals[day.date].sales += day.sales || 0;
                dailyTotals[day.date].adsCost += day.adsCost || 0;
                dailyTotals[day.date].profit += day.profit || 0;
            });

            const sortedDays = Object.values(dailyTotals).sort((a, b) => new Date(a.date) - new Date(b.date));
            console.log('‡∏à‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏≤‡∏ü:', sortedDays.length);
            
            if (sortedDays.length === 0) {
                // Show empty chart message
                charts.salesTrend = new Chart(ctx, {
                    type: 'line',
                    data: { labels: ['‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å' }
                        }
                    }
                });
                return;
            }

            const dates = sortedDays.map(day => formatDateThai(day.date));

            const datasets = [
                {
                    label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)',
                    data: sortedDays.map(day => day.sales),
                    borderColor: '#3b82f6',
                    backgroundColor: '#3b82f620',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.4,
                    yAxisID: 'y'
                },
                {
                    label: '‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå',
                    data: sortedDays.map(day => day.orders),
                    borderColor: '#10b981',
                    backgroundColor: '#10b98120',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.4,
                    yAxisID: 'y1'
                },
                {
                    label: '‡∏Å‡∏≥‡πÑ‡∏£ (‡∏ö‡∏≤‡∏ó)',
                    data: sortedDays.map(day => day.profit),
                    borderColor: '#f59e0b',
                    backgroundColor: '#f59e0b20',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.4,
                    yAxisID: 'y'
                }
            ];

            charts.salesTrend = new Chart(ctx, {
                type: 'line',
                data: { 
                    labels: dates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢/‡∏Å‡∏≥‡πÑ‡∏£ (‡∏ö‡∏≤‡∏ó)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('th-TH') + ' ‡∏ö‡∏≤‡∏ó';
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: '‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('th-TH');
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateProductOrdersChart() {
            const ctx = document.getElementById('productOrdersChart').getContext('2d');
            if (charts.productOrders) charts.productOrders.destroy();

            const productNames = Object.keys(productsData);
            const productOrdersData = productNames.map(name => {
                const rangeData = getDataInRange(productsData[name].dailyData, currentStartDate, currentEndDate);
                const aggregated = aggregateRangeData(rangeData);
                return aggregated.orders;
            });

            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4', '#84cc16'];

            charts.productOrders = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: productNames,
                    datasets: [{
                        data: productOrdersData,
                        backgroundColor: colors.slice(0, productNames.length),
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed.toLocaleString('th-TH')} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateCostDistributionChart() {
            const ctx = document.getElementById('costDistributionChart').getContext('2d');
            if (charts.costDistribution) charts.costDistribution.destroy();

            // Calculate total costs across all products in range
            let totalAdsCost = 0;
            let totalVAT = 0;
            let totalProfit = 0;
            let totalSales = 0;

            Object.values(productsData).forEach(product => {
                const rangeData = getDataInRange(product.dailyData, currentStartDate, currentEndDate);
                const aggregated = aggregateRangeData(rangeData);
                totalAdsCost += aggregated.adsCost;
                totalVAT += aggregated.vat;
                totalProfit += aggregated.profit;
                totalSales += aggregated.sales;
            });

            const costOfGoods = totalSales - totalAdsCost - totalVAT - totalProfit;

            charts.costDistribution = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤', 'VAT', '‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'],
                    datasets: [{
                        data: [Math.max(0, costOfGoods), totalAdsCost, totalVAT, Math.max(0, totalProfit)],
                        backgroundColor: ['#6b7280', '#f59e0b', '#ef4444', '#10b981'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateProfitByProductChart() {
            const ctx = document.getElementById('profitByProductChart').getContext('2d');
            if (charts.profitByProduct) charts.profitByProduct.destroy();

            const productNames = Object.keys(productsData);
            const profitData = productNames.map(name => {
                const rangeData = getDataInRange(productsData[name].dailyData, currentStartDate, currentEndDate);
                const aggregated = aggregateRangeData(rangeData);
                return aggregated.profit;
            });

            const colors = profitData.map(profit => profit >= 0 ? '#10b981' : '#ef4444');

            charts.profitByProduct = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: productNames,
                    datasets: [{
                        label: '‡∏Å‡∏≥‡πÑ‡∏£ (‡∏ö‡∏≤‡∏ó)',
                        data: profitData,
                        backgroundColor: colors,
                        borderColor: colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '‡∏Å‡∏≥‡πÑ‡∏£ (‡∏ö‡∏≤‡∏ó)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('th-TH') + ' ‡∏ö‡∏≤‡∏ó';
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `‡∏Å‡∏≥‡πÑ‡∏£: ${context.parsed.y.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó`;
                            }
                        }
                    }
                }
            });
        }

        function updateProductTable() {
            const tableBody = document.getElementById('productTable');
            
            if (Object.keys(productsData).length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-8 text-gray-500">
                            ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                        </td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = Object.values(productsData).map(product => {
                const rangeData = getDataInRange(product.dailyData, currentStartDate, currentEndDate);
                const aggregated = aggregateRangeData(rangeData);
                
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-3 font-medium">${product.name}</td>
                        <td class="text-right py-3">${aggregated.orders.toLocaleString('th-TH')}</td>
                        <td class="text-right py-3">${aggregated.items.toLocaleString('th-TH')}</td>
                        <td class="text-right py-3">${aggregated.sales.toLocaleString('th-TH')}</td>
                        <td class="text-right py-3">${aggregated.adsCost.toLocaleString('th-TH')}</td>
                        <td class="text-right py-3">${aggregated.vat.toLocaleString('th-TH')}</td>
                        <td class="text-right py-3 ${aggregated.profit >= 0 ? 'profit-positive' : 'profit-negative'}">
                            ${aggregated.profit.toLocaleString('th-TH')}
                        </td>
                        <td class="text-center py-3">
                            <button class="text-blue-600 hover:text-blue-800 text-sm" onclick="viewProductDetails('${product.name}')">
                                ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function viewProductDetails(productName) {
            const product = productsData[productName];
            if (!product) return;
            
            const rangeData = getDataInRange(product.dailyData, currentStartDate, currentEndDate);
            const aggregated = aggregateRangeData(rangeData);
            
            alert(`‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${productName}\n\n` +
                  `‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${formatDateThai(currentStartDate)} - ${formatDateThai(currentEndDate)}\n` +
                  `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô: ${rangeData.length} ‡∏ß‡∏±‡∏ô\n\n` +
                  `‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå: ${aggregated.orders.toLocaleString('th-TH')}\n` +
                  `‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${aggregated.items.toLocaleString('th-TH')}\n` +
                  `‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: ${aggregated.sales.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤: ${aggregated.adsCost.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó\n` +
                  `VAT: ${aggregated.vat.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó\n` +
                  `‡∏Å‡∏≥‡πÑ‡∏£: ${aggregated.profit.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó`);
        }

        // Export functionality
        async function exportDashboard() {
            const format = document.getElementById('exportFormat').value;
            const includeSummary = document.getElementById('includeSummary').checked;
            const includeProducts = document.getElementById('includeProducts').checked;
            const includeCharts = document.getElementById('includeCharts').checked;
            const includeTable = document.getElementById('includeTable').checked;

            const exportBtn = document.getElementById('exportConfirmBtn');
            const spinner = exportBtn.querySelector('.loading-spinner');
            
            exportBtn.disabled = true;
            spinner.classList.remove('hidden');

            try {
                // Create export container
                const exportContainer = document.createElement('div');
                exportContainer.className = 'dashboard-export';
                exportContainer.style.width = '1200px';
                exportContainer.innerHTML = `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1 style="font-size: 28px; font-weight: bold; color: #1f2937; margin-bottom: 10px;">
                            üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                        </h1>
                        <p style="font-size: 16px; color: #6b7280;">
                            ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${formatDateThai(currentStartDate)} - ${formatDateThai(currentEndDate)}
                        </p>
                        <p style="font-size: 14px; color: #9ca3af;">
                            ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date().toLocaleString('th-TH')}
                        </p>
                    </div>
                `;

                if (includeSummary) {
                    const summarySection = document.querySelector('section:nth-of-type(2)').cloneNode(true);
                    exportContainer.appendChild(summarySection);
                }

                if (includeProducts) {
                    const productsSection = document.querySelector('section:nth-of-type(4)').cloneNode(true);
                    exportContainer.appendChild(productsSection);
                }

                if (includeCharts) {
                    const chartsSection = document.querySelector('section:nth-of-type(5)').cloneNode(true);
                    exportContainer.appendChild(chartsSection);
                }

                if (includeTable) {
                    const tableSection = document.querySelector('section:nth-of-type(6)').cloneNode(true);
                    exportContainer.appendChild(tableSection);
                }

                document.body.appendChild(exportContainer);

                if (format === 'pdf') {
                    const canvas = await html2canvas(exportContainer, {
                        scale: 2,
                        useCORS: true,
                        allowTaint: true
                    });
                    
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('l', 'mm', 'a4');
                    const imgData = canvas.toDataURL('image/png');
                    
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                    
                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                    pdf.save(`dashboard-${currentStartDate}-${currentEndDate}.pdf`);
                } else {
                    const canvas = await html2canvas(exportContainer, {
                        scale: 2,
                        useCORS: true,
                        allowTaint: true
                    });
                    
                    const link = document.createElement('a');
                    link.download = `dashboard-${currentStartDate}-${currentEndDate}.${format}`;
                    link.href = canvas.toDataURL(`image/${format}`);
                    link.click();
                }

                document.body.removeChild(exportContainer);
                document.getElementById('exportModal').classList.add('hidden');
                
            } catch (error) {
                console.error('Export failed:', error);
                alert('‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
            } finally {
                exportBtn.disabled = false;
                spinner.classList.add('hidden');
            }
        }

        // Initialize date inputs with current range
        document.addEventListener('DOMContentLoaded', function() {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            
            if (startDateInput && endDateInput) {
                startDateInput.value = currentStartDate;
                endDateInput.value = currentEndDate;
                updateDateRangeDisplay();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9851b06e749cee56',t:'MTc1ODg3ODQ2Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
